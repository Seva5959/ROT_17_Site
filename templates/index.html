{% extends "base.html" %}

{% block title %}–†–∞–∑–≥–∞–¥–∞–π –∫–æ–¥{% endblock %}

{% block content %}
<div class="container">
    <h1>–ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑–≥–∞–¥–∞–Ω–Ω—ã–π —à–∏—Ñ—Ä!</h1>

    <!-- –ë–ª–æ–∫ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤—Å–µ —Ä–µ—à–µ–Ω–æ) -->
    {% if all_solved %}
    <div class="congratulations-container" id="congratsContainer">
        <div class="congratulations-card">
            <div class="confetti-container">
                {% for _ in range(10) %}<div class="confetti"></div>{% endfor %}
            </div>
            <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
            <p>–í—ã —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≥–∞–¥–∞–ª–∏ –≤—Å–µ —à–∏—Ñ—Ä—ã!</p>
            <div class="full-link-container">
                <p>–í–æ—Ç –ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞:</p>
                <div class="full-link-box">
                    <input type="text" id="fullLink" value="{{ full_link }}" readonly>
                    <button onclick="copyToClipboard('fullLink')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div class="copy-success-message">–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!</div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="grid">
        {% for code in codes %}
            <div class="card {{ 'solved' if code.solved }}">
                <span class="card-number">{{ code.roman_number }}</span>

                {% if code.solved %}
                    <div class="success-message">‚úÖ –£—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≥–∞–¥–∞–Ω–æ!</div>
                    <button class="toggle-btn">‚ñº –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
                    <div class="answer-block">
                        <input type="text"
                               value="{{ answers[code.number] }}"
                               id="answer-{{ code.id }}"
                               readonly>
                        <button class="copy-btn" onclick="copyToClipboard('answer-{{ code.id }}')">
                            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                {% else %}
                    <form method="POST" action="{{ url_for('check', code_id=code.id) }}">
                        <input type="text"
                               name="decoded_text"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"
                               required>
                        <button type="submit">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </form>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <!-- –ë–ª–æ–∫ —Å –ø–æ–ª–Ω–æ–π —Å—Å—ã–ª–∫–æ–π (—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤—Å–µ —Ä–µ—à–µ–Ω–æ) -->
    {% if all_solved %}
    <div class="permanent-link-section">
        <h3>–ü–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞:</h3>
        <div class="full-link-box">
            <input type="text" id="permanentLink" value="{{ full_link }}" readonly>
            <button onclick="copyToClipboard('permanentLink')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    document.execCommand('copy');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = element.nextElementSibling?.querySelector('.copy-success-message') ||
                         document.querySelector('.copy-success-message');

    if (notification) {
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 2000);
    }
}

// –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
function toggleCongrats(show) {
    const container = document.getElementById('congratsContainer');
    if (container) {
        container.style.display = show ? 'flex' : 'none';
    }
}

// –ê–≤—Ç–æ–ø–æ–∫–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –µ—Å–ª–∏ –≤—Å–µ —Ä–µ—à–µ–Ω–æ
{% if all_solved %}
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => toggleCongrats(true), 500);
});
{% endif %}
</script>
{% endblock %}